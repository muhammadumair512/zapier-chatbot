<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zapier Chatbot Embed</title>
    <script
      async
      type="module"
      src="https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js"
    ></script>
  </head>
  <body>
    <!-- Chatbot Embed -->
    <zapier-interfaces-chatbot-embed
      id="chatbot-iframe"
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
      style="position: relative"
    ></zapier-interfaces-chatbot-embed>

    <script>
      //count 5
      let count = 0; // Initialize count

      // Function to increase count and log it
      function increaseCount() {
        count++;
        console.log(`Button pressed count: ${count}`);
      }

      // Key press handler for Enter key
      function handleKeyPress(event) {
        const chatbotEmbed = document.getElementById("chatbot-iframe");

        if (event.key === "Enter" && document.activeElement === chatbotEmbed) {
          increaseCount();
        }
      }

      // Function to observe the chatbot embed and add overlay
      function observeChatbotEmbed() {
        const chatbotEmbed = document.getElementById("chatbot-iframe");

        if (!chatbotEmbed) {
          console.log("Chatbot embed not found.");
          return;
        }

        // Add an overlay div for bottom-right corner detection
        const overlay = document.createElement("div");
        overlay.style.position = "absolute";
        overlay.style.bottom = "0";
        overlay.style.right = "0";
        overlay.style.width = "100px";
        overlay.style.height = "100px";
        overlay.style.cursor = "pointer";
        overlay.style.backgroundColor = "rgba(0, 0, 0, 0.1)"; // Optional: visible for testing

        chatbotEmbed.appendChild(overlay);

        // Listen for clicks in the overlay area
        overlay.addEventListener("click", increaseCount);

        // Listen for Enter key presses
        window.addEventListener("keydown", handleKeyPress);

        console.log("Chatbot iframe detected and overlay added.");
      }

      // Set up a MutationObserver to detect when the chatbot embed loads
      const observer = new MutationObserver((mutationsList, observer) => {
        for (const mutation of mutationsList) {
          if (mutation.type === "childList") {
            const chatbotEmbed = document.getElementById("chatbot-iframe");
            if (chatbotEmbed) {
              observeChatbotEmbed();
              observer.disconnect(); // Stop observing once we find the iframe
              break;
            }
          }
        }
      });

      // Start observing the document for changes
      observer.observe(document.body, { childList: true, subtree: true });
    </script>
  </body>
</html>
