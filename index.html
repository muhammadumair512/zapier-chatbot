<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iframe Button Click Counter</title>
  </head>
  <body>
    <!-- Your chatbot iframe -->
    <zapier-interfaces-chatbot-embed
      id="chatbot-embed"
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
    ></zapier-interfaces-chatbot-embed>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let clickCount = 0;

        // Select the iframe element
        const chatbotEmbed = document.querySelector(
          "zapier-interfaces-chatbot-embed"
        );

        if (!chatbotEmbed) {
          console.error("Chatbot embed not found in the DOM.");
          return;
        }

        // Use MutationObserver to wait for the iframe to load
        const observer = new MutationObserver((mutationsList, observer) => {
          // Check if the iframe is available in the DOM
          const iframe = chatbotEmbed.shadowRoot?.querySelector("iframe"); // Access shadow DOM if used
          if (iframe && iframe.contentDocument) {
            observer.disconnect(); // Stop observing once we find the iframe

            // Access the iframe's document and set up a listener for the button
            const iframeDoc =
              iframe.contentDocument || iframe.contentWindow.document;

            // Use MutationObserver inside the iframe to detect the button load
            const iframeObserver = new MutationObserver(() => {
              const button = iframeDoc.querySelector("span.sr-only");

              if (button) {
                console.log("Button found inside the iframe!");
                iframeObserver.disconnect(); // Stop observing once button is found

                // Add event listener for button clicks
                button.addEventListener("click", () => {
                  clickCount++;
                  console.log(`Button clicked ${clickCount} times.`);
                });
              } else {
                console.log("Button not found yet. Retrying...");
              }
            });

            // Observe mutations inside the iframe
            iframeObserver.observe(iframeDoc, {
              childList: true,
              subtree: true,
            });
          }
        });

        // Start observing the chatbot embed for any changes (to detect iframe)
        observer.observe(chatbotEmbed, { childList: true, subtree: true });
      });
    </script>
  </body>
</html>
