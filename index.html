<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zapier Chatbot Embed</title>
    <script
      async
      type="module"
      src="https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js"
    ></script>
    <style>
      /* Style to highlight bottom-right 100px area for easier targeting */
      #click-zone {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background-color: rgba(0, 0, 0, 0.1);
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <!-- Chatbot Embed -->
    <zapier-interfaces-chatbot-embed
      id="chatbot-iframe"
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
      style="position: relative"
    ></zapier-interfaces-chatbot-embed>

    <!-- Click zone div overlay for the bottom-right corner -->
    <div id="click-zone"></div>

    <script>
      // update 3
      let count = 0; // Initialize count

      function increaseCount() {
        count++;
        console.log(`Button pressed count: ${count}`);
      }

      // Add event listeners to the click-zone div for bottom-right corner clicks
      const clickZone = document.getElementById("click-zone");
      clickZone.addEventListener("click", increaseCount);

      // Function to handle "Enter" key press when focused inside the iframe
      function handleKeyPress(event) {
        if (event.key === "Enter" && document.activeElement === chatbotEmbed) {
          increaseCount();
        }
      }

      // Function to monitor the iframe and set up listeners
      function observeChatbotEmbed() {
        const chatbotEmbed = document.getElementById("chatbot-iframe");

        if (!chatbotEmbed) {
          console.log("Chatbot embed not found.");
          return;
        }

        // Listen for Enter key presses
        window.addEventListener("keydown", handleKeyPress);

        console.log(
          "MutationObserver: Chatbot iframe found, listeners active."
        );
      }

      // Set up a MutationObserver to detect when the chatbot embed loads
      const observer = new MutationObserver((mutationsList, observer) => {
        for (const mutation of mutationsList) {
          if (mutation.type === "childList") {
            const chatbotEmbed = document.getElementById("chatbot-iframe");
            if (chatbotEmbed) {
              observeChatbotEmbed();
              observer.disconnect(); // Stop observing once we find the iframe
              break;
            }
          }
        }
      });

      // Start observing the document for changes
      observer.observe(document.body, { childList: true, subtree: true });
    </script>
  </body>
</html>
