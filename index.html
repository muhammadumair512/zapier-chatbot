<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zapier Chatbot Embed</title>
    <script
      async
      type="module"
      src="https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js"
    ></script>
  </head>
  <body>
    <zapier-interfaces-chatbot-embed
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
    ></zapier-interfaces-chatbot-embed>

    <script>
      // Initialize the request count and log it to the console on page load
      let requestCount = 0;
      console.log(`Button pressed = ${requestCount}`);

      // Create a MutationObserver to watch for changes in the chatbot container
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          // Check if any new nodes are added
          if (mutation.addedNodes.length) {
            mutation.addedNodes.forEach((node) => {
              // Look for network request indicators based on elements or class changes
              if (node.nodeType === 1) {
                // Check for element nodes
                const url = node.querySelector(
                  '[href="https://test-c918f0.zapier.app/api/chat"]'
                );

                // Increment count if request URL is detected
                if (url) {
                  requestCount++;
                  console.log(`Button pressed = ${requestCount}`);
                }
              }
            });
          }
        });
      });

      // Target the chatbot embed container to monitor it
      const targetNode = document.querySelector(
        "zapier-interfaces-chatbot-embed"
      );

      // Options for the observer (watching for changes in child elements)
      const config = { childList: true, subtree: true };

      // Start observing the target node
      if (targetNode) {
        observer.observe(targetNode, config);
      } else {
        console.warn("Chatbot embed element not found.");
      }
    </script>
  </body>
</html>
