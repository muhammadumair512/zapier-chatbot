<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zapier Chatbot Embed</title>
    <script
      async
      type="module"
      src="https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js"
    ></script>
  </head>
  <body>
    <zapier-interfaces-chatbot-embed
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
    ></zapier-interfaces-chatbot-embed>

    <script>
      // update 2
      let clickCount = 0;

      function logClickCount() {
        console.log(`Button clicked = ${clickCount}`);
      }

      function handleButtonClick() {
        clickCount++;
        logClickCount();
      }

      function tryToAddClickListener(root) {
        // Attempt to find the button inside the specified root (Shadow or regular DOM)
        const button = root.querySelector(
          "button.mx-[2px].my-1.5.flex.w-[42px]"
        );

        if (button) {
          const span = button.querySelector("span.sr-only");
          if (span) {
            span.addEventListener("click", handleButtonClick);
            console.log(
              "Click listener attached to 'sr-only' span inside button."
            );
            return true; // Listener added successfully
          }
        }
        return false; // Element not found
      }

      function observeEmbedForButton() {
        const zapierEmbed = document.querySelector(
          "zapier-interfaces-chatbot-embed"
        );

        if (!zapierEmbed) {
          console.error("Zapier chatbot embed not found.");
          return;
        }

        // Observe the Shadow DOM or regular DOM for changes
        const observer = new MutationObserver(() => {
          const shadowRoot = zapierEmbed.shadowRoot || zapierEmbed;

          if (tryToAddClickListener(shadowRoot)) {
            observer.disconnect(); // Stop observing once the listener is attached
          } else {
            console.warn(
              "Button with 'sr-only' span not yet found. Retrying..."
            );
          }
        });

        // Start observing child changes in either Shadow DOM or regular DOM
        observer.observe(zapierEmbed, { childList: true, subtree: true });
      }

      // Initialize the observer to look for the button once DOM content is loaded
      document.addEventListener("DOMContentLoaded", () => {
        observeEmbedForButton();
        logClickCount(); // Log initial click count on page load
      });
    </script>
  </body>
</html>
