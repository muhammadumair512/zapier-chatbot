<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iframe Button Click Counter</title>
  </head>
  <body>
    <!-- Embed your chatbot iframe -->
    <zapier-interfaces-chatbot-embed
      id="chatbot-embed"
      is-popup="false"
      chatbot-id="cm2yan90j000c7aty144l4g3v"
      height="600px"
      width="400px"
    ></zapier-interfaces-chatbot-embed>

    <script>
      // Variable to count button clicks and Enter presses
      let clickCount = 0;
      let enterCount = 0;

      // Function to handle button clicks
      function handleButtonClick() {
        clickCount++;
        console.log(`Button clicked ${clickCount} times.`);
      }

      // Function to handle Enter key press
      function handleEnterKeyPress(event) {
        if (event.key === "Enter") {
          enterCount++;
          console.log(`Enter key pressed ${enterCount} times.`);
        }
      }

      // Set up MutationObserver to watch for iframe load and its content
      document.addEventListener("DOMContentLoaded", () => {
        const chatbotEmbed = document.querySelector(
          "zapier-interfaces-chatbot-embed"
        );

        if (!chatbotEmbed) {
          console.error("Chatbot embed not found.");
          return;
        }

        // Observe the chatbot element for changes (specifically shadow DOM)
        const observer = new MutationObserver(() => {
          const shadowRoot = chatbotEmbed.shadowRoot;

          if (shadowRoot) {
            const iframe = shadowRoot.querySelector("iframe");

            if (iframe) {
              // Stop observing after we find the iframe
              observer.disconnect();

              // Access the iframe's document
              const iframeDoc =
                iframe.contentDocument || iframe.contentWindow.document;

              // Observe the iframe's content for the button and textarea
              const iframeObserver = new MutationObserver(() => {
                // Find the button inside the iframe
                const button = iframeDoc.querySelector("button");

                if (button) {
                  console.log("Button found inside the iframe!");

                  // Add click event listener to the button
                  button.addEventListener("click", handleButtonClick);

                  // Add event listener for Enter key inside the iframe's document
                  const textarea = iframeDoc.querySelector("textarea");
                  if (textarea) {
                    textarea.addEventListener("keydown", handleEnterKeyPress);
                  }

                  // Stop observing once the button and textarea are found
                  iframeObserver.disconnect();
                } else {
                  console.log("Button not found yet inside the iframe.");
                }
              });

              // Start observing the iframe document for changes
              iframeObserver.observe(iframeDoc, {
                childList: true,
                subtree: true,
              });
            } else {
              console.log("Iframe not found in shadow root.");
            }
          } else {
            console.log("Shadow root not found yet. Retrying...");
          }
        });

        // Start observing the chatbot embed element for shadow root
        observer.observe(chatbotEmbed, { childList: true, subtree: true });
      });
    </script>
  </body>
</html>
